{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/petrol_station/frontend/src/context/auth-context.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport axios from \"axios\";\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: \"ADMIN\" | \"ATTENDANT\" | \"SUPPLIER\" | \"USER\";\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  isAuthenticated: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  register: (name: string, email: string, password: string) => Promise<User>;\r\n  logout: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const router = useRouter();\r\n\r\n  // âœ… Track authentication\r\n  const isAuthenticated = !!user;\r\n\r\n  // ðŸ”¹ Fetch current user from backend (/me)\r\n  const fetchUser = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await axios.get(\"http://localhost:5000/api/auth/me\", {\r\n        withCredentials: true, // send cookies automatically\r\n      });\r\n      setUser(response.data);\r\n    } catch {\r\n      setUser(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ðŸ”¹ Call fetchUser on app start\r\n  useEffect(() => {\r\n    fetchUser();\r\n  }, []);\r\n\r\n  // ðŸ”¹ Login\r\n  const login = async (email: string, password: string) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await axios.post(\r\n        \"http://localhost:5000/api/auth/login\",\r\n        { email, password },\r\n        { withCredentials: true } // cookie will be set automatically\r\n      );\r\n\r\n      setUser(res.data.user);\r\n\r\n      // Redirect based on role\r\n      switch (res.data.user.role) {\r\n        case \"ADMIN\":\r\n          router.push(\"/admin/dashboard\");\r\n          break;\r\n        case \"ATTENDANT\":\r\n          router.push(\"/attendant/dashboard\");\r\n          break;\r\n        case \"SUPPLIER\":\r\n          router.push(\"/supplier/dashboard\");\r\n          break;\r\n        default:\r\n          router.push(\"/\");\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.message || \"Login failed\");\r\n      throw err;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ðŸ”¹ Register\r\n  const register = async (name: string, email: string, password: string) => {\r\n    if (!user || user.role !== \"ADMIN\") {\r\n      const message = \"Only admin can register new users\";\r\n      setError(message);\r\n      throw new Error(message);\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await axios.post(\r\n        \"http://localhost:5000/api/auth/register\",\r\n        { name, email, password },\r\n        { withCredentials: true }\r\n      );\r\n\r\n      return res.data.user as User;\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.message || \"Registration failed\");\r\n      throw err;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ðŸ”¹ Logout\r\n  const logout = async () => {\r\n    setLoading(true);\r\n    try {\r\n      await axios.post(\r\n        \"http://localhost:5000/api/auth/logout\",\r\n        {},\r\n        { withCredentials: true } // tells browser to send cookie\r\n      );\r\n    } catch {\r\n      // ignore errors on logout\r\n    } finally {\r\n      setUser(null);\r\n      setLoading(false);\r\n      router.push(\"/login\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        isAuthenticated,\r\n        loading,\r\n        error,\r\n        login,\r\n        register,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (!context) throw new Error(\"useAuth must be used within AuthProvider\");\r\n  return context;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAuBA,MAAM,4BAAc,IAAA,kOAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,6NAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,6NAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,6NAAQ,EAAgB;IAClD,MAAM,SAAS,IAAA,2JAAS;IAExB,yBAAyB;IACzB,MAAM,kBAAkB,CAAC,CAAC;IAE1B,2CAA2C;IAC3C,MAAM,YAAY;QAChB,WAAW;QACX,IAAI;YACF,MAAM,WAAW,MAAM,4JAAK,CAAC,GAAG,CAAC,qCAAqC;gBACpE,iBAAiB;YACnB;YACA,QAAQ,SAAS,IAAI;QACvB,EAAE,OAAM;YACN,QAAQ;QACV,SAAU;YACR,WAAW;QACb;IACF;IAEA,iCAAiC;IACjC,IAAA,8NAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,WAAW;IACX,MAAM,QAAQ,OAAO,OAAe;QAClC,WAAW;QACX,SAAS;QACT,IAAI;YACF,MAAM,MAAM,MAAM,4JAAK,CAAC,IAAI,CAC1B,wCACA;gBAAE;gBAAO;YAAS,GAClB;gBAAE,iBAAiB;YAAK,EAAE,mCAAmC;;YAG/D,QAAQ,IAAI,IAAI,CAAC,IAAI;YAErB,yBAAyB;YACzB,OAAQ,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI;gBACxB,KAAK;oBACH,OAAO,IAAI,CAAC;oBACZ;gBACF,KAAK;oBACH,OAAO,IAAI,CAAC;oBACZ;gBACF,KAAK;oBACH,OAAO,IAAI,CAAC;oBACZ;gBACF;oBACE,OAAO,IAAI,CAAC;YAChB;QACF,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW;YACxC,MAAM;QACR,SAAU;YACR,WAAW;QACb;IACF;IAEA,cAAc;IACd,MAAM,WAAW,OAAO,MAAc,OAAe;QACnD,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;YAClC,MAAM,UAAU;YAChB,SAAS;YACT,MAAM,IAAI,MAAM;QAClB;QAEA,WAAW;QACX,SAAS;QACT,IAAI;YACF,MAAM,MAAM,MAAM,4JAAK,CAAC,IAAI,CAC1B,2CACA;gBAAE;gBAAM;gBAAO;YAAS,GACxB;gBAAE,iBAAiB;YAAK;YAG1B,OAAO,IAAI,IAAI,CAAC,IAAI;QACtB,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW;YACxC,MAAM;QACR,SAAU;YACR,WAAW;QACb;IACF;IAEA,YAAY;IACZ,MAAM,SAAS;QACb,WAAW;QACX,IAAI;YACF,MAAM,4JAAK,CAAC,IAAI,CACd,yCACA,CAAC,GACD;gBAAE,iBAAiB;YAAK,EAAE,+BAA+B;;QAE7D,EAAE,OAAM;QACN,0BAA0B;QAC5B,SAAU;YACR,QAAQ;YACR,WAAW;YACX,OAAO,IAAI,CAAC;QACd;IACF;IAEA,qBACE,0PAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,+NAAU,EAAC;IAC3B,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;IAC9B,OAAO;AACT","debugId":null}}]
}