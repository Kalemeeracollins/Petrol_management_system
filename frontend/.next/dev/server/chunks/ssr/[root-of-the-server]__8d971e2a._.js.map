{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/petrol_station/frontend/src/context/auth-context.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from \"react\"\r\nimport axios from \"axios\"\r\nimport { useRouter } from \"next/navigation\"\r\n\r\ninterface User {\r\n  id: string\r\n  name: string\r\n  email: string\r\n  role: \"ADMIN\" | \"ATTENDANT\" | \"SUPPLIER\" | \"USER\"\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null\r\n  token: string | null\r\n  isAuthenticated: boolean\r\n  loading: boolean\r\n  error: string | null\r\n  login: (email: string, password: string) => Promise<void>\r\n  register: (name: string, email: string, password: string) => Promise<User>\r\n  logout: () => void\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [token, setToken] = useState<string | null>(null)\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const router = useRouter()\r\n\r\n  // ðŸ”¹ Load user + token from localStorage on startup\r\n  useEffect(() => {\r\n    const savedToken = localStorage.getItem(\"auth_token\")\r\n    const savedUser = localStorage.getItem(\"auth_user\")\r\n\r\n    if (savedToken && savedUser) {\r\n      try {\r\n        const parsedUser = JSON.parse(savedUser)\r\n        setToken(savedToken)\r\n        setUser(parsedUser)\r\n        setIsAuthenticated(true)\r\n      } catch {\r\n        localStorage.removeItem(\"auth_token\")\r\n        localStorage.removeItem(\"auth_user\")\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  // ðŸ”¹ Save user/token to state + localStorage\r\n  const saveAuth = (userData: User, token: string) => {\r\n    setUser(userData)\r\n    setToken(token)\r\n    setIsAuthenticated(true)\r\n    localStorage.setItem(\"auth_token\", token)\r\n    localStorage.setItem(\"auth_user\", JSON.stringify(userData))\r\n  }\r\n\r\n  // ðŸ”¹ Login user and redirect based on role\r\n  const login = async (email: string, password: string) => {\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://localhost:5000/api/auth/login\",\r\n        { email, password },\r\n        { headers: { \"Content-Type\": \"application/json\" } }\r\n      )\r\n\r\n      const data = response.data\r\n      const userData: User = {\r\n        id: data.user.id,\r\n        name: data.user.name,\r\n        email: data.user.email,\r\n        role: data.user.role || \"user\",\r\n      }\r\n\r\n      saveAuth(userData, data.token)\r\n\r\n      // âœ… Redirect based on role\r\n      if (userData.role === \"ADMIN\") router.push(\"/admin/dashboard\")\r\n      else if (userData.role === \"ATTENDANT\") router.push(\"/attendant/dashboard\")\r\n      else if (userData.role === \"SUPPLIER\") router.push(\"/supplier/dashboard\")\r\n      else router.push(\"/\")\r\n\r\n    } catch (err: any) {\r\n      console.error(\"Login failed:\", err)\r\n      setError(err.response?.data?.message || \"Login failed\")\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // ðŸ”¹ Only admin can register new users\r\n  const register = async (name: string, email: string, password: string) => {\r\n    if (!user || user.role !== \"ADMIN\") {\r\n      const message = \"Only admin can register new users\"\r\n      setError(message)\r\n      throw new Error(message)\r\n    }\r\n\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://localhost:5000/api/auth/register\",\r\n        { name, email, password },\r\n        {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        }\r\n      )\r\n\r\n      const data = response.data\r\n      const newUser: User = {\r\n        id: data.user.id,\r\n        name: data.user.name,\r\n        email: data.user.email,\r\n        role: data.user.role || \"user\",\r\n      }\r\n\r\n      return newUser\r\n    } catch (err: any) {\r\n      console.error(\"Registration failed:\", err)\r\n      setError(err.response?.data?.message || \"Registration failed\")\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // ðŸ”¹ Logout user\r\n  const logout = () => {\r\n    setUser(null)\r\n    setToken(null)\r\n    setIsAuthenticated(false)\r\n    localStorage.removeItem(\"auth_token\")\r\n    localStorage.removeItem(\"auth_user\")\r\n    router.push(\"/login\")\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        token,\r\n        isAuthenticated,\r\n        loading,\r\n        error,\r\n        login,\r\n        register,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext)\r\n  if (!context) throw new Error(\"useAuth must be used within AuthProvider\")\r\n  return context\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}