{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/petrol_station/frontend/src/app/dashboard/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { createContext, useContext, useState, useEffect, type ReactNode } from \"react\"\r\n\r\ninterface User {\r\n  id: string\r\n  name: string\r\n  email: string\r\n  role: \"admin\" | \"user\" | string\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null\r\n  token: string | null\r\n  isAuthenticated: boolean\r\n  loading: boolean\r\n  error: string | null\r\n  login: (email: string, password: string) => Promise<void>\r\n  register: (name: string, email: string, password: string) => Promise<User>\r\n  logout: () => void\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [token, setToken] = useState<string | null>(null)\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Load user from localStorage on mount\r\n  useEffect(() => {\r\n    const savedToken = localStorage.getItem(\"auth_token\")\r\n    const savedUser = localStorage.getItem(\"auth_user\")\r\n\r\n    if (savedToken && savedUser) {\r\n      try {\r\n        setToken(savedToken)\r\n        setUser(JSON.parse(savedUser))\r\n        setIsAuthenticated(true)\r\n      } catch {\r\n        localStorage.removeItem(\"auth_token\")\r\n        localStorage.removeItem(\"auth_user\")\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const saveAuth = (userData: User, token: string) => {\r\n    setUser(userData)\r\n    setToken(token)\r\n    setIsAuthenticated(true)\r\n    localStorage.setItem(\"auth_token\", token)\r\n    localStorage.setItem(\"auth_user\", JSON.stringify(userData))\r\n  }\r\n\r\n  const login = async (email: string, password: string) => {\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await fetch(\"http://localhost:5000/api/login\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email, password }),\r\n      })\r\n\r\n      let data\r\n      try {\r\n        data = await response.json()\r\n      } catch {\r\n        throw new Error(\"Server did not return valid JSON\")\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new Error(data?.message || \"Login failed\")\r\n      }\r\n\r\n      const userData: User = {\r\n        id: data.user.id,\r\n        name: data.user.name,\r\n        email: data.user.email,\r\n        role: data.user.role || \"user\",\r\n      }\r\n\r\n      saveAuth(userData, data.token)\r\n    } catch (err: any) {\r\n      setError(err.message || \"Login failed\")\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // Admin-only registration\r\n  const register = async (name: string, email: string, password: string) => {\r\n    if (!user || user.role !== \"admin\") {\r\n      const message = \"Only admin can register new users\"\r\n      setError(message)\r\n      throw new Error(message)\r\n    }\r\n\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await fetch(\"http://localhost:5000/api/register\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({ name, email, password }),\r\n      })\r\n\r\n      let data\r\n      try {\r\n        data = await response.json()\r\n      } catch {\r\n        throw new Error(\"Server did not return valid JSON\")\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new Error(data?.message || \"Registration failed\")\r\n      }\r\n\r\n      const newUser: User = {\r\n        id: data.user.id,\r\n        name: data.user.name,\r\n        email: data.user.email,\r\n        role: data.user.role || \"user\",\r\n      }\r\n\r\n      return newUser\r\n    } catch (err: any) {\r\n      setError(err.message || \"Registration failed\")\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const logout = () => {\r\n    setUser(null)\r\n    setToken(null)\r\n    setIsAuthenticated(false)\r\n    localStorage.removeItem(\"auth_token\")\r\n    localStorage.removeItem(\"auth_user\")\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        token,\r\n        isAuthenticated,\r\n        loading,\r\n        error,\r\n        login,\r\n        register,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext)\r\n  if (!context) throw new Error(\"useAuth must be used within AuthProvider\")\r\n  return context\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}