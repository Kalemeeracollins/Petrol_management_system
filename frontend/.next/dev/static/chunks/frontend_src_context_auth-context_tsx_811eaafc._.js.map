{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/petrol_station/frontend/src/context/auth-context.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useState, useEffect, ReactNode } from \"react\"\nimport axios from \"axios\"\nimport { useRouter } from \"next/navigation\"\n\ninterface User {\n  id: string\n  name: string\n  email: string\n  role: \"ADMIN\" | \"ATTENDANT\" | \"SUPPLIER\" | \"USER\"\n}\n\ninterface AuthContextType {\n  user: User | null\n  isAuthenticated: boolean\n  loading: boolean\n  error: string | null\n  login: (email: string, password: string) => Promise<void>\n  logout: () => Promise<void>\n  register: (name: string, email: string, password: string, role?: string) => Promise<void> // âœ… added\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const router = useRouter()\n\n  // ðŸ”¹ Fetch logged-in user on app start\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/api/auth/me\", {\n          withCredentials: true,\n        })\n        setUser(res.data)\n      } catch {\n        setUser(null)\n      } finally {\n        setLoading(false)\n      }\n    }\n    fetchUser()\n  }, [])\n\n  // ðŸ”¹ Login function\n  const login = async (email: string, password: string) => {\n    setLoading(true)\n    setError(null)\n    try {\n      const res = await axios.post(\n        \"http://localhost:5000/api/auth/login\",\n        { email, password },\n        { withCredentials: true }\n      )\n\n      const loggedInUser = res.data.user || res.data\n      setUser(loggedInUser)\n\n      // Redirect by role\n      switch (loggedInUser.role) {\n        case \"ADMIN\":\n          router.push(\"/admin/dashboard\")\n          break\n        case \"ATTENDANT\":\n          router.push(\"/attendant/dashboard\")\n          break\n        case \"SUPPLIER\":\n          router.push(\"/supplier/dashboard\")\n          break\n        default:\n          router.push(\"/\")\n      }\n    } catch (err: any) {\n      setError(err.response?.data?.message || \"Login failed\")\n      throw err\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // ðŸ”¹ Register function (NEW)\n  const register = async (name: string, email: string, password: string, role = \"ATTENDANT\") => {\n    setLoading(true)\n    setError(null)\n    try {\n      const res = await axios.post(\n        \"http://localhost:5000/api/auth/register\", // your backend attendants route\n        { name, email, password, role },\n        { withCredentials: true }\n      )\n\n      // Optional: set user if you want to log in right after register\n      // setUser(res.data.user || res.data)\n\n      console.log(\"Attendant created:\", res.data)\n      alert(\"âœ… Attendant added successfully!\")\n    } catch (err: any) {\n      console.error(err)\n      setError(err.response?.data?.message || \"Registration failed\")\n      throw err\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // ðŸ”¹ Logout\n  const logout = async () => {\n    setLoading(true)\n    try {\n      await axios.post(\"http://localhost:5000/api/auth/logout\", {}, { withCredentials: true })\n    } catch {\n      // ignore errors\n    } finally {\n      setUser(null)\n      setLoading(false)\n      router.push(\"/login\")\n    }\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isAuthenticated: !!user,\n        loading,\n        error,\n        login,\n        logout,\n        register, // âœ… added here\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (!context) throw new Error(\"useAuth must be used within AuthProvider\")\n  return context\n}\n// Fetch user on page load\nexport const fetchUser = async () => {\n  try {\n    const res = await fetch(\"http://localhost:5000/api/auth/me\", {\n      credentials: \"include\",\n    });\n\n    if (!res.ok) throw new Error(\"Failed to fetch user\");\n\n    const data = await res.json();\n    setUser(data.user); // attach to context\n    setIsAuthenticated(true);\n  } catch (err) {\n    console.error(err);\n    setUser(null);\n    setIsAuthenticated(false);\n  }\n};\nfunction setIsAuthenticated(arg0: boolean) {\n  throw new Error(\"Function not implemented.\")\n}\n\nfunction setUser(user: any) {\n  throw new Error(\"Function not implemented.\")\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}